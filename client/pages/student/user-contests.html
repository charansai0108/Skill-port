<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>My Contests - PW IOI Community</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link href="../../css/tailwind.min.css" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
  <script src="../../js/apiService.js"></script>
  <script src="../../js/notifications.js"></script>
  <script src="../../js/authManager.js"></script>
  <script src="../../js/contextManager.js"></script>
  <script src="../../js/dataLoader.js"></script>
  <script src="../../js/uiHelpers.js"></script>
  <script src="../../js/pageController.js"></script>
  <script src="../../js/userContestsController.js"></script>
  <style>
    body { font-family: 'Inter', sans-serif; }
    
    /* Enhanced transitions and animations */
    .nav-link {
      transition: all 0.3s ease-in-out;
    }
    
    .nav-link:hover {
      background: rgba(255, 255, 255, 0.9);
      border-color: rgba(59, 130, 246, 0.3);
      box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
      transform: translateY(-2px);
    }
    
    /* Enhanced glassy cards */
    .dashboard-card {
      transition: all 0.3s ease-in-out;
      backdrop-filter: blur(15px);
      background: rgba(255, 255, 255, 0.7);
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    .dashboard-card:hover {
      background: rgba(255, 255, 255, 0.9);
      border-color: rgba(59, 130, 246, 0.4);
      box-shadow: 0 8px 24px rgba(31, 38, 135, 0.15);
      transform: translateY(-2px) scale(1.01);
    }
    
    /* Contest cards hover effects with blue palette */
    .contest-card {
      transition: all 0.3s ease-in-out;
      border: 2px solid rgba(255, 255, 255, 0.6);
      border-radius: 16px;
      box-shadow: 
        0 4px 12px rgba(0, 0, 0, 0.1),
        0 0 0 1px rgba(59, 130, 246, 0.05);
    }
    
    .contest-card:hover {
      transform: translateY(-3px) scale(1.02);
      border-color: rgba(59, 130, 246, 0.6);
      border-width: 3px;
      box-shadow: 
        0 8px 25px rgba(59, 130, 246, 0.2),
        0 0 0 2px rgba(59, 130, 246, 0.2);
      background: rgba(255, 255, 255, 0.95);
    }
    
         /* Info grid styling - no enhanced effects */
     .contest-card .bg-gradient-to-br {
       transition: all 0.3s ease-in-out;
     }
    
    /* Ensure contest descriptions stay on single line and don't overflow */
    .contest-card .text-slate-500 {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
      width: 100%;
    }
    
    /* Ensure the description container doesn't overflow */
    .contest-card .flex.items-center.gap-4 > div:last-child {
      min-width: 0;
      flex: 1;
    }
    
    .contest-card .flex.items-center.gap-4 > div:last-child .text-slate-500 {
      max-width: 100%;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    /* Glass button styling */
    .glass-btn {
      transition: all 0.3s ease-in-out;
      backdrop-filter: blur(10px);
    }
    
    .glass-btn:hover {
      transform: translateY(-1px) scale(1.05);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .page-content {
      animation: slideIn 0.3s ease-out;
    }
    
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }
  </style>
</head>
<body class="bg-gradient-to-br from-slate-50 via-white to-blue-50 min-h-screen">
  <!-- Navbar -->
  <nav class="sticky top-0 z-30 bg-white/90 backdrop-blur-xl border-b border-slate-200/50 shadow-sm">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <div class="flex items-center gap-2 group">
          <div class="w-8 h-8 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-lg flex items-center justify-center group-hover:scale-105 transition-transform">
            <i data-lucide="user" class="w-5 h-5 text-white"></i>
          </div>
          <span class="text-xl font-bold bg-gradient-to-r from-slate-900 to-slate-600 bg-clip-text text-transparent">
            <span id="navbar-student-name">Student</span>
          </span>
        </div>
        <div class="hidden md:flex items-center gap-1">
          <a href="user-dashboard.html" class="flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium text-slate-600 hover:text-slate-900 hover:bg-slate-50 transition-all">
            <i data-lucide="layout-dashboard" class="w-4 h-4"></i> Dashboard
          <a href="user-contests.html" class="flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium bg-blue-50 text-blue-700 shadow-sm">
            <i data-lucide="trophy" class="w-4 h-4"></i> Contests
          </a>
          <a href="user-leaderboard.html" class="flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium text-slate-600 hover:text-slate-900 hover:bg-slate-50 transition-all">
            <i data-lucide="award" class="w-4 h-4"></i> Leaderboard
          </a>
          <a href="user-mentor-feedback.html" class="flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium text-slate-600 hover:text-slate-900 hover:bg-slate-50 transition-all">
            <i data-lucide="message-square" class="w-4 h-4"></i> Mentor Feedback
          </a>
          <a href="user-profile.html" class="flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium text-slate-600 hover:text-slate-900 hover:bg-slate-50 transition-all">
            <img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=32&h=32&fit=crop&crop=face" alt="Profile" class="w-8 h-8 rounded-full object-cover shadow-lg border-2 border-white">
          </a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 page-content">
    <!-- Contests Content -->
    <div id="contests-content">
      <div class="mb-8">
        <h2 class="text-2xl font-bold text-slate-900">My Assigned Contests</h2>
      </div>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <!-- Weekly Algorithm Challenge Card -->
        <div class="contest-card bg-white rounded-xl shadow-lg p-6 flex flex-col gap-4 border border-slate-100">
          <div class="flex items-center gap-4">
            <div class="w-14 h-14 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-lg flex items-center justify-center text-white text-2xl font-bold">A</div>
            <div>
              <h2 class="text-xl font-bold text-slate-900">Weekly Algorithm Challenge</h2>
              <div class="text-sm text-slate-500">Weekly competitive programming contest focusing on algorithms and problem-solving skills.</div>
            </div>
          </div>
          <div class="grid grid-cols-2 gap-4 mb-5">
            <!-- Category -->
            <div class="bg-gradient-to-br from-blue-50/80 to-blue-100/60 backdrop-blur-sm rounded-lg p-3 border border-blue-200/30">
              <div class="flex items-center gap-2 mb-1">
                <i data-lucide="tag" class="w-4 h-4 text-blue-600"></i>
                <span class="text-xs font-medium text-blue-700 uppercase tracking-wide">Category</span>
              </div>
              <span class="text-sm font-semibold text-blue-900">Algorithms</span>
            </div>
            
            <!-- Batch -->
            <div class="bg-gradient-to-br from-yellow-50/80 to-yellow-100/60 backdrop-blur-sm rounded-lg p-3 border border-yellow-200/30">
              <div class="flex items-center gap-2 mb-1">
                <i data-lucide="users" class="w-4 h-4 text-yellow-600"></i>
                <span class="text-xs font-medium text-yellow-700 uppercase tracking-wide">Batch</span>
              </div>
              <span class="text-sm font-semibold text-yellow-900" id="user-contest-batch">2024-25</span>
            </div>
            
            <!-- Participants -->
            <div class="bg-gradient-to-br from-green-50/80 to-green-100/60 backdrop-blur-sm rounded-lg p-3 border border-green-200/30">
              <div class="flex items-center gap-2 mb-1">
                <i data-lucide="users" class="w-4 h-4 text-green-600"></i>
                <span class="text-xs font-medium text-green-700 uppercase tracking-wide">Participants</span>
              </div>
              <span class="text-sm font-semibold text-green-900">156</span>
            </div>
            
            <!-- Start Date -->
            <div class="bg-gradient-to-br from-purple-50/80 to-purple-100/60 backdrop-blur-sm rounded-lg p-3 border border-purple-200/30">
              <div class="flex items-center gap-2 mb-1">
                <i data-lucide="calendar" class="w-4 h-4 text-purple-600"></i>
                <span class="text-xs font-medium text-purple-700 uppercase tracking-wide">Start Date</span>
              </div>
              <span class="text-sm font-semibold text-purple-900">Jan 15, 2025</span>
            </div>
          </div>
          <div class="flex items-center justify-between mt-4">
            <a href="contest-participation.html" class="glass-btn bg-blue-600/90 backdrop-blur-sm text-white px-4 py-2 rounded-lg font-semibold flex items-center gap-2 hover:bg-blue-700/90 hover:scale-105 transition-all duration-300 border border-blue-500/30 shadow-lg">
              <i data-lucide="play" class="w-4 h-4"></i> Participate
            </a>
            <button onclick="openContestLeaderboardModal('Weekly Algorithm Challenge')" class="glass-btn p-2 rounded-lg border border-slate-200/50 hover:bg-slate-50/80 hover:scale-105 transition-all duration-300 backdrop-blur-sm shadow-md" title="View Leaderboard">
              <i data-lucide="bar-chart-3" class="w-5 h-5 text-blue-600"></i>
            </button>
          </div>
        </div>
        
        <!-- SQL Contest Card -->
        <div class="contest-card bg-white rounded-xl shadow-lg p-6 flex flex-col gap-4 border border-slate-100">
          <div class="flex items-center gap-4">
            <div class="w-14 h-14 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg flex items-center justify-center text-white text-2xl font-bold">S</div>
            <div>
              <h2 class="text-xl font-bold text-slate-900">SQL Database Master</h2>
              <div class="text-sm text-slate-500">Advanced contest focusing on database design and SQL optimization.</div>
            </div>
          </div>
          <div class="grid grid-cols-2 gap-4 mb-5">
            <!-- Category -->
            <div class="bg-gradient-to-br from-blue-50/80 to-blue-100/60 backdrop-blur-sm rounded-lg p-3 border border-blue-200/30">
              <div class="flex items-center gap-2 mb-1">
                <i data-lucide="tag" class="w-4 h-4 text-blue-600"></i>
                <span class="text-xs font-medium text-blue-700 uppercase tracking-wide">Category</span>
              </div>
              <span class="text-sm font-semibold text-blue-900">Database</span>
            </div>
            
            <!-- Batch -->
            <div class="bg-gradient-to-br from-yellow-50/80 to-yellow-100/60 backdrop-blur-sm rounded-lg p-3 border border-yellow-200/30">
              <div class="flex items-center gap-2 mb-1">
                <i data-lucide="users" class="w-4 h-4 text-yellow-600"></i>
                <span class="text-xs font-medium text-yellow-700 uppercase tracking-wide">Batch</span>
              </div>
              <span class="text-sm font-semibold text-yellow-900">Spring 2025</span>
            </div>
            
            <!-- Participants -->
            <div class="bg-gradient-to-br from-green-50/80 to-green-100/60 backdrop-blur-sm rounded-lg p-3 border border-green-200/30">
              <div class="flex items-center gap-2 mb-1">
                <i data-lucide="users" class="w-4 h-4 text-green-600"></i>
                <span class="text-xs font-medium text-green-700 uppercase tracking-wide">Participants</span>
              </div>
              <span class="text-sm font-semibold text-green-900">89</span>
            </div>
            
            <!-- Start Date -->
            <div class="bg-gradient-to-br from-purple-50/80 to-purple-100/60 backdrop-blur-sm rounded-lg p-3 border border-purple-200/30">
              <div class="flex items-center gap-2 mb-1">
                <i data-lucide="calendar" class="w-4 h-4 text-purple-600"></i>
                <span class="text-xs font-medium text-purple-700 uppercase tracking-wide">Start Date</span>
              </div>
              <span class="text-sm font-semibold text-purple-900">Jan 22, 2025</span>
            </div>
          </div>
          <div class="flex items-center justify-between mt-4">
            <a href="contest-participation.html" class="glass-btn bg-blue-600/90 backdrop-blur-sm text-white px-4 py-2 rounded-lg font-semibold flex items-center gap-2 hover:bg-blue-700/90 hover:scale-105 transition-all duration-300 border border-blue-500/30 shadow-lg">
              <i data-lucide="play" class="w-4 h-4"></i> Participate
            </a>
            <button onclick="openContestLeaderboardModal('SQL Database Master')" class="glass-btn p-2 rounded-lg border border-slate-200/50 hover:bg-slate-50/80 hover:scale-105 transition-all duration-300 backdrop-blur-sm shadow-md" title="View Leaderboard">
              <i data-lucide="bar-chart-3" class="w-5 h-5 text-green-600"></i>
            </button>
            </div>
          </div>
        </div>
      </div>
      

    </div> <!-- End of contests-content -->
    
    <!-- Contest Leaderboard Modal -->
    <div id="contest-leaderboard-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
      <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden">
        <!-- Modal Header -->
        <div class="bg-gradient-to-r from-blue-600 to-indigo-600 px-6 py-4 text-white">
          <div class="flex items-center justify-between">
            <h3 class="text-xl font-bold" id="modal-contest-title">Contest Leaderboard</h3>
            <button onclick="closeContestLeaderboardModal()" class="text-white hover:text-blue-100 transition-colors">
              <i data-lucide="x" class="w-6 h-6"></i>
            </button>
          </div>
        </div>
        
        <!-- Modal Content -->
        <div class="p-6 overflow-y-auto max-h-[calc(90vh-120px)]">
                     <!-- Your Performance Highlight - Moved to Top -->
           <div class="mb-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200">
             <div class="flex items-center justify-between">
               <div class="flex items-center gap-3">
                 <i data-lucide="award" class="w-6 h-6 text-blue-600"></i>
                 <span class="text-lg font-semibold text-blue-900">Your Performance</span>
               </div>
               <div class="text-right">
                 <div class="text-2xl font-bold text-blue-600" id="modal-your-rank">#3</div>
                 <div class="text-sm text-blue-700">Current Rank</div>
               </div>
             </div>
           </div>
           
           <!-- Contest Info -->
           <div class="mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
             <div class="flex items-center justify-between">
               <div>
                 <h4 class="text-lg font-semibold text-blue-900" id="modal-contest-name">Contest Name</h4>
                 <p class="text-sm text-blue-700" id="modal-contest-desc">Contest description</p>
               </div>
               <div class="text-right">
                 <div class="text-2xl font-bold text-blue-600" id="modal-total-participants">156</div>
                 <div class="text-sm text-blue-700">Participants</div>
               </div>
             </div>
           </div>
           
           <!-- Search Bar -->
           <div class="mb-6">
             <div class="relative">
               <i data-lucide="search" class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-slate-400"></i>
               <input type="text" id="leaderboard-search" placeholder="Search students..." class="w-full pl-10 pr-4 py-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
             </div>
           </div>
           
           <!-- Leaderboard Table -->
           <div class="bg-white rounded-lg border border-slate-200 overflow-hidden">
             <table class="w-full">
               <thead class="bg-slate-50">
                 <tr>
                   <th class="px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider w-16">RANK</th>
                   <th class="pl-4 pr-2 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider w-48">STUDENT</th>
                   <th class="pl-1 pr-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider w-32">PROBLEMS SOLVED</th>
                   <th class="px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider w-24">SCORE</th>
                   <th class="px-4 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider w-24">TIME</th>
                 </tr>
               </thead>
               <tbody id="modal-leaderboard-body" class="bg-white divide-y divide-slate-200">
                 <!-- Dynamic content will be loaded here -->
               </tbody>
             </table>
           </div>
        </div>
        
        <!-- Modal Footer -->
        <div class="bg-slate-50 px-6 py-4 flex justify-end gap-3">
          <button onclick="closeContestLeaderboardModal()" class="px-4 py-2 text-slate-600 hover:text-slate-800 transition-colors">
            Close
          </button>
          <button onclick="exportContestLeaderboard()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
            <i data-lucide="download" class="w-4 h-4 inline mr-2"></i>
            Export
          </button>
        </div>
      </div>
    </div>
  </main>

    <!-- Load API and App scripts -->
  <script src="../../js/apiService.js"></script>
  <script src="../../js/notifications.js"></script>
  <script src="../../js/authManager.js"></script>
  <script src="../../js/contextManager.js"></script>
  <script src="../../js/dataLoader.js"></script>
  <script src="../../js/uiHelpers.js"></script>
  <script src="../../js/pageController.js"></script>
  <script src="../../js/userContestsController.js"></script>

  <script>
    lucide.createIcons();
    
    // Check authentication on page load
    document.addEventListener('DOMContentLoaded', () => {
      // Check authentication first
      if (window.authManager && !window.authManager.isAuthenticated) {
        window.location.href = 'pages/auth/login.html';
        return;
      }

      // Check if user is student
      if (window.authManager && !window.authManager.isStudent()) {
        window.location.href = 'pages/auth/login.html';
        return;
      }

      // Initialize DataManager for dynamic data
      if (window.DataManager) {
        window.DataManager.updateUserContestData();
      }
    });
    
         // Contest leaderboard data
     const contestData = {
       'Weekly Algorithm Challenge': {
         name: 'Weekly Algorithm Challenge',
         description: 'Weekly competitive programming contest focusing on algorithms and problem-solving skills.',
         participants: 156,
         yourRank: 3,
         leaderboard: [
           { rank: 1, name: 'Priya Sharma', problemsSolved: '5/5', percentage: '100%', score: 850, time: '2h 15m' },
           { rank: 2, name: 'Rahul Kumar', problemsSolved: '5/5', percentage: '100%', score: 820, time: '2h 45m' },
           { rank: 3, name: 'Alex Johnson', problemsSolved: '3/5', percentage: '60%', score: 780, time: '3h 20m' },
           { rank: 4, name: 'Suresh Kumar', problemsSolved: '2/5', percentage: '40%', score: 650, time: '4h 10m' },
           { rank: 5, name: 'Priya Patel', problemsSolved: '1/5', percentage: '20%', score: 450, time: '5h 30m' },
           { rank: 6, name: 'Amit Singh', problemsSolved: '1/5', percentage: '20%', score: 420, time: '5h 45m' },
           { rank: 7, name: 'Neha Gupta', problemsSolved: '0/5', percentage: '0%', score: 380, time: '6h 20m' },
           { rank: 8, name: 'Vikram Malhotra', problemsSolved: '0/5', percentage: '0%', score: 350, time: '6h 45m' },
           { rank: 9, name: 'Anjali Desai', problemsSolved: '0/5', percentage: '0%', score: 320, time: '7h 10m' },
           { rank: 10, name: 'Rajesh Verma', problemsSolved: '0/5', percentage: '0%', score: 290, time: '7h 35m' },
           { rank: 11, name: 'Meera Iyer', problemsSolved: '0/5', percentage: '0%', score: 260, time: '8h 0m' },
           { rank: 12, name: 'Arjun Reddy', problemsSolved: '0/5', percentage: '0%', score: 230, time: '8h 25m' },
           { rank: 13, name: 'Kavya Nair', problemsSolved: '0/5', percentage: '0%', score: 200, time: '8h 50m' },
           { rank: 14, name: 'Dev Patel', problemsSolved: '0/5', percentage: '0%', score: 170, time: '9h 15m' },
           { rank: 15, name: 'Zara Khan', problemsSolved: '0/5', percentage: '0%', score: 140, time: '9h 40m' },
           { rank: 16, name: 'Rohan Mehta', problemsSolved: '0/5', percentage: '0%', score: 110, time: '10h 5m' },
           { rank: 17, name: 'Ishita Sharma', problemsSolved: '0/5', percentage: '0%', score: 80, time: '10h 30m' },
           { rank: 18, name: 'Aditya Joshi', problemsSolved: '0/5', percentage: '0%', score: 50, time: '10h 55m' },
           { rank: 19, name: 'Tanvi Agarwal', problemsSolved: '0/5', percentage: '0%', score: 20, time: '11h 20m' },
           { rank: 20, name: 'Krishna Rao', problemsSolved: '0/5', percentage: '0%', score: 0, time: '12h 0m' }
         ]
       },
       'SQL Database Master': {
         name: 'SQL Database Master',
         description: 'Advanced contest focusing on database design and SQL optimization.',
         participants: 89,
         yourRank: 1,
         leaderboard: [
           { rank: 1, name: 'Alex Johnson', problemsSolved: '6/8', percentage: '75%', score: 920, time: '1h 55m' },
           { rank: 2, name: 'Suresh Kumar', problemsSolved: '5/8', percentage: '62.5%', score: 850, time: '2h 30m' },
           { rank: 3, name: 'Priya Sharma', problemsSolved: '4/8', percentage: '50%', score: 720, time: '3h 15m' },
           { rank: 4, name: 'Rahul Kumar', problemsSolved: '3/8', percentage: '37.5%', score: 580, time: '4h 20m' },
           { rank: 5, name: 'Priya Patel', problemsSolved: '2/8', percentage: '25%', score: 420, time: '5h 45m' },
           { rank: 6, name: 'Amit Singh', problemsSolved: '2/8', percentage: '25%', score: 400, time: '6h 10m' },
           { rank: 7, name: 'Neha Gupta', problemsSolved: '1/8', percentage: '12.5%', score: 350, time: '6h 35m' },
           { rank: 8, name: 'Vikram Malhotra', problemsSolved: '1/8', percentage: '12.5%', score: 320, time: '7h 0m' },
           { rank: 9, name: 'Anjali Desai', problemsSolved: '0/8', percentage: '0%', score: 280, time: '7h 25m' },
           { rank: 10, name: 'Rajesh Verma', problemsSolved: '0/8', percentage: '0%', score: 240, time: '7h 50m' },
           { rank: 11, name: 'Meera Iyer', problemsSolved: '0/8', percentage: '0%', score: 200, time: '8h 15m' },
           { rank: 12, name: 'Arjun Reddy', problemsSolved: '0/8', percentage: '0%', score: 160, time: '8h 40m' },
           { rank: 13, name: 'Kavya Nair', problemsSolved: '0/8', percentage: '0%', score: 120, time: '9h 5m' },
           { rank: 14, name: 'Dev Patel', problemsSolved: '0/8', percentage: '0%', score: 80, time: '9h 30m' },
           { rank: 15, name: 'Zara Khan', problemsSolved: '0/8', percentage: '0%', score: 40, time: '9h 55m' },
           { rank: 16, name: 'Rohan Mehta', problemsSolved: '0/8', percentage: '0%', score: 0, time: '10h 20m' }
         ]
       }
     };
    
    // Open contest leaderboard modal
    function openContestLeaderboardModal(contestName) {
      const modal = document.getElementById('contest-leaderboard-modal');
      const contest = contestData[contestName];
      
      if (contest) {
        // Update modal content
        document.getElementById('modal-contest-title').textContent = `${contestName} - Leaderboard`;
        document.getElementById('modal-contest-name').textContent = contest.name;
        document.getElementById('modal-contest-desc').textContent = contest.description;
        document.getElementById('modal-total-participants').textContent = contest.participants;
        document.getElementById('modal-your-rank').textContent = `#${contest.yourRank}`;
        
        // Populate leaderboard table
        const tbody = document.getElementById('modal-leaderboard-body');
        tbody.innerHTML = '';
        
                 // Store original leaderboard data for search functionality
         window.currentLeaderboard = contest.leaderboard;
         
         contest.leaderboard.forEach((entry, index) => {
           const row = document.createElement('tr');
           const isCurrentUser = entry.name === 'Alex Johnson';
           const rowClass = isCurrentUser ? 'bg-blue-50 border-2 border-blue-200' : index % 2 === 0 ? 'bg-white' : 'bg-slate-50';
           
           row.className = rowClass;
           row.innerHTML = `
             <td class="px-4 py-4 whitespace-nowrap w-16">
               <div class="w-8 h-8 ${entry.rank <= 3 ? 'bg-amber-500' : 'bg-slate-500'} rounded-full flex items-center justify-center text-white font-bold">${entry.rank}</div>
             </td>
             <td class="px-4 py-4 whitespace-nowrap w-48">
               <div class="flex items-center gap-3">
                 <div class="w-8 h-8 bg-gradient-to-br from-blue-400 to-indigo-500 rounded-full flex items-center justify-center text-white font-semibold">${entry.name.charAt(0)}</div>
                 <div>
                   <div class="text-sm font-medium text-slate-900">${entry.name}</div>
                 </div>
               </div>
             </td>
             <td class="px-4 py-4 whitespace-nowrap w-32">
               <div class="text-sm font-medium text-slate-900">${entry.problemsSolved}</div>
               <div class="text-xs text-slate-500">${entry.percentage}</div>
             </td>
             <td class="px-4 py-4 whitespace-nowrap w-24">
               <div class="text-sm font-bold ${entry.rank <= 3 ? 'text-amber-600' : 'text-slate-600'}">${entry.score}</div>
             </td>
             <td class="px-4 py-4 whitespace-nowrap w-24">
               <div class="text-xs text-slate-500">${entry.time}</div>
             </td>
           `;
           tbody.appendChild(row);
         });
         
         // Add search functionality
         const searchInput = document.getElementById('leaderboard-search');
         if (searchInput) {
           searchInput.addEventListener('input', filterLeaderboard);
         }
        
        // Show modal
        modal.classList.remove('hidden');
      }
    }
    
    // Close contest leaderboard modal
    function closeContestLeaderboardModal() {
      const modal = document.getElementById('contest-leaderboard-modal');
      modal.classList.add('hidden');
    }
    
         // Export contest leaderboard
     function exportContestLeaderboard() {
       // Simple export functionality - could be enhanced with actual CSV export
       alert('Leaderboard export functionality would be implemented here');
     }
     
     // Filter leaderboard based on search
     function filterLeaderboard() {
       const searchTerm = document.getElementById('leaderboard-search').value.toLowerCase();
       const tbody = document.getElementById('modal-leaderboard-body');
       const originalData = window.currentLeaderboard;
       
       if (!originalData) return;
       
       // Filter data based on search term
       const filteredData = originalData.filter(entry => 
         entry.name.toLowerCase().includes(searchTerm)
       );
       
       // Clear and repopulate table
       tbody.innerHTML = '';
       
                filteredData.forEach((entry, index) => {
           const row = document.createElement('tr');
           const isCurrentUser = entry.name === 'Alex Johnson';
           const rowClass = isCurrentUser ? 'bg-blue-50 border-2 border-blue-200' : index % 2 === 0 ? 'bg-white' : 'bg-slate-50';
           
           row.className = rowClass;
           row.innerHTML = `
             <td class="px-4 py-4 whitespace-nowrap w-16">
               <div class="w-8 h-8 ${entry.rank <= 3 ? 'bg-amber-500' : 'bg-slate-500'} rounded-full flex items-center justify-center text-white font-bold">${entry.rank}</div>
             </td>
             <td class="px-4 py-4 whitespace-nowrap w-48">
               <div class="flex items-center gap-3">
                 <div class="w-8 h-8 bg-gradient-to-br from-blue-400 to-indigo-500 rounded-full flex items-center justify-center text-white font-semibold">${entry.name.charAt(0)}</div>
                 <div>
                   <div class="text-sm font-medium text-slate-900">${entry.name}</div>
                 </div>
               </div>
             </td>
             <td class="px-4 py-4 whitespace-nowrap w-32">
               <div class="text-sm font-medium text-slate-900">${entry.problemsSolved}</div>
               <div class="text-xs text-slate-500">${entry.percentage}</div>
             </td>
             <td class="px-4 py-4 whitespace-nowrap w-24">
               <div class="text-sm font-bold ${entry.rank <= 3 ? 'text-amber-600' : 'text-slate-600'}">${entry.score}</div>
             </td>
             <td class="px-4 py-4 whitespace-nowrap w-24">
               <div class="text-xs text-slate-500">${entry.time}</div>
             </td>
           `;
           tbody.appendChild(row);
         });
     }
    
    // Close modal when clicking outside
    document.addEventListener('click', (e) => {
      const modal = document.getElementById('contest-leaderboard-modal');
      if (e.target === modal) {
        closeContestLeaderboardModal();
      }
    });
    
    // Close modal with Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeContestLeaderboardModal();
      }
    });
    
    // Dynamic contest loading functionality
    async function loadUserContests() {
      try {
        console.log('Loading user contests...');
        showLoadingState();
        const response = await window.SkillPortAPI.getContests();
        if (response.success) {
          displayUserContests(response.data);
        } else {
          console.error('Failed to load contests:', response.message);
          showStaticContests();
        }
      } catch (error) {
        console.error('Error loading contests:', error);
        showStaticContests();
      }
    }

    function displayUserContests(contests) {
      const contestsContainer = document.querySelector('.grid.grid-cols-1.md\\:grid-cols-2');
      if (!contestsContainer) return;

      if (contests.length === 0) {
        contestsContainer.innerHTML = `
          <div class="col-span-2 text-center py-12">
            <div class="w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <i data-lucide="trophy" class="w-8 h-8 text-slate-400"></i>
            </div>
            <h3 class="text-lg font-semibold text-slate-700 mb-2">No Contests Assigned</h3>
            <p class="text-slate-500">You haven't been assigned to any contests yet.</p>
          </div>
        `;
        lucide.createIcons();
        return;
      }

      contestsContainer.innerHTML = contests.map(contest => createUserContestCard(contest)).join('');
      lucide.createIcons();
    }

    function createUserContestCard(contest) {
      const status = getContestStatus(contest);
      const statusClass = getStatusClass(status);

      return `
        <div class="contest-card bg-white rounded-xl shadow-lg p-6 flex flex-col gap-4 border border-slate-100">
          <div class="flex items-center gap-4">
            <div class="w-14 h-14 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-lg flex items-center justify-center text-white text-2xl font-bold">${contest.name.charAt(0)}</div>
            <div>
              <h2 class="text-xl font-bold text-slate-900">${contest.name}</h2>
              <div class="text-sm text-slate-500">${contest.description}</div>
            </div>
          </div>
          <div class="grid grid-cols-2 gap-4 mb-5">
            <div class="bg-gradient-to-br from-blue-50/80 to-blue-100/60 backdrop-blur-sm rounded-lg p-3 border border-blue-200/30">
              <div class="flex items-center gap-2 mb-1">
                <i data-lucide="tag" class="w-4 h-4 text-blue-600"></i>
                <span class="text-xs font-medium text-blue-700 uppercase tracking-wide">Category</span>
              </div>
              <span class="text-sm font-semibold text-blue-900">${contest.category}</span>
            </div>
            <div class="bg-gradient-to-br from-yellow-50/80 to-yellow-100/60 backdrop-blur-sm rounded-lg p-3 border border-yellow-200/30">
              <div class="flex items-center gap-2 mb-1">
                <i data-lucide="users" class="w-4 h-4 text-yellow-600"></i>
                <span class="text-xs font-medium text-yellow-700 uppercase tracking-wide">Batch</span>
              </div>
              <span class="text-sm font-semibold text-yellow-900">${contest.batch || 'Default'}</span>
            </div>
            <div class="bg-gradient-to-br from-green-50/80 to-green-100/60 backdrop-blur-sm rounded-lg p-3 border border-green-200/30">
              <div class="flex items-center gap-2 mb-1">
                <i data-lucide="users" class="w-4 h-4 text-green-600"></i>
                <span class="text-xs font-medium text-green-700 uppercase tracking-wide">Participants</span>
              </div>
              <span class="text-sm font-semibold text-green-900">${contest.participants || 0}</span>
            </div>
            <div class="bg-gradient-to-br from-purple-50/80 to-purple-100/60 backdrop-blur-sm rounded-lg p-3 border border-purple-200/30">
              <div class="flex items-center gap-2 mb-1">
                <i data-lucide="calendar" class="w-4 h-4 text-purple-600"></i>
                <span class="text-xs font-medium text-purple-700 uppercase tracking-wide">Start Date</span>
              </div>
              <span class="text-sm font-semibold text-purple-900">${formatDate(contest.startDate)}</span>
            </div>
          </div>
          <div class="flex items-center justify-between mt-4">
            <a href="contest-participation.html?contest=${contest._id}" class="glass-btn bg-blue-600/90 backdrop-blur-sm text-white px-4 py-2 rounded-lg font-semibold flex items-center gap-2 hover:bg-blue-700/90 hover:scale-105 transition-all duration-300 border border-blue-500/30 shadow-lg">
              <i data-lucide="play" class="w-4 h-4"></i> Participate
            </a>
            <button onclick="openContestLeaderboardModal('${contest.name}')" class="glass-btn p-2 rounded-lg border border-slate-200/50 hover:bg-slate-50/80 hover:scale-105 transition-all duration-300 backdrop-blur-sm shadow-md" title="View Leaderboard">
              <i data-lucide="bar-chart-3" class="w-5 h-5 text-blue-600"></i>
            </button>
          </div>
        </div>
      `;
    }

    function showLoadingState() {
      const contestsContainer = document.querySelector('.grid.grid-cols-1.md\\:grid-cols-2');
      if (!contestsContainer) return;
      contestsContainer.innerHTML = `
        <div class="col-span-2 text-center py-12">
          <div class="w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4 animate-spin">
            <i data-lucide="loader-2" class="w-8 h-8 text-slate-400"></i>
          </div>
          <h3 class="text-lg font-semibold text-slate-700 mb-2">Loading Contests...</h3>
          <p class="text-slate-500">Please wait while we fetch your contests</p>
        </div>
      `;
      lucide.createIcons();
    }

    function showStaticContests() {
      // Keep existing static content as fallback
      console.log('Showing static contests as fallback');
    }

    function getContestStatus(contest) {
      const now = new Date();
      const startDate = new Date(contest.startDate);
      const endDate = new Date(contest.endDate);
      
      if (now < startDate) return 'Upcoming';
      if (now >= startDate && now <= endDate) return 'Active';
      return 'Completed';
    }

    function getStatusClass(status) {
      switch(status) {
        case 'Active': return 'bg-green-100 text-green-700';
        case 'Upcoming': return 'bg-blue-100 text-blue-700';
        case 'Completed': return 'bg-gray-100 text-gray-700';
        default: return 'bg-gray-100 text-gray-700';
      }
    }

    function formatDate(dateString) {
      return new Date(dateString).toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'short',
        day: 'numeric'
      });
    }
    
         // Page functionality
     document.addEventListener('DOMContentLoaded', () => {
       // Set student name in navbar
       const navbarStudentName = document.getElementById('navbar-student-name');
       if (navbarStudentName) {
         navbarStudentName.textContent = 'Alex Johnson';
       }
       
       // Initialize DataManager for dynamic data
       if (window.DataManager) {
         window.DataManager.updateUserContestData();
       }
       
       // Load contests dynamically
       loadUserContests();
     });
  </script>
</body>
</html> 