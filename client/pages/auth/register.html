<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register - SkillPort</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <script src="../../js/apiService.js"></script>
    <script src="../../js/notifications.js"></script>
    <script src="../../js/authManager.js"></script>
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
        }
        
        .auth-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.1);
            transition: all 0.3s ease;
        }
        
        .auth-card:hover {
            background: rgba(255, 255, 255, 1);
            border-color: rgba(239, 68, 68, 0.4);
            box-shadow: 0 12px 40px rgba(31, 38, 135, 0.15);
        }
        
        .form-input {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(226, 232, 240, 0.8);
            transition: all 0.2s ease;
        }
        
        .form-input:focus {
            background: rgba(255, 255, 255, 1);
            border-color: rgba(239, 68, 68, 0.5);
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.3);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(226, 232, 240, 0.8);
            color: #64748b;
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 1);
            border-color: rgba(239, 68, 68, 0.3);
            color: #ef4444;
            transform: translateY(-2px);
        }
        
        .role-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .role-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(31, 38, 135, 0.15);
        }
        
        .form-container { 
            display: none; 
        }
        
        .form-container.show { 
            display: block !important; 
            animation: slideInUp 0.3s ease-out;
        }
        
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .auth-container {
            animation: fadeInUp 0.6s ease-out;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-red-50 via-pink-50 to-orange-50 min-h-screen p-4">
    <div class="auth-container max-w-6xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-12">
            <div class="flex items-center justify-center gap-3 mb-4">
                <div class="w-12 h-12 bg-gradient-to-br from-red-600 to-pink-600 rounded-xl flex items-center justify-center shadow-lg">
                    <i data-lucide="target" class="w-6 h-6 text-white"></i>
                </div>
                <h1 class="text-2xl font-bold bg-gradient-to-r from-red-600 to-pink-600 bg-clip-text text-transparent">
                    SkillPort
                </h1>
            </div>
            <h2 class="text-3xl font-bold text-slate-800 mb-4">Create Your Account</h2>
            <p class="text-slate-600 text-lg">Join the SkillPort community and start your journey</p>
        </div>

        <!-- Role Selection -->
        <div id="roleSelection" class="max-w-4xl mx-auto mb-12">
            <h3 class="text-xl font-bold text-slate-800 text-center mb-8">Choose Your Role</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Personal User Card -->
                <div class="role-card auth-card rounded-3xl p-8 cursor-pointer" onclick="showForm('personal')">
                    <div class="text-center">
                        <div class="w-20 h-20 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-lg">
                            <i data-lucide="user" class="w-10 h-10 text-white"></i>
                        </div>
                        <h3 class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent mb-4">Personal Learner</h3>
                        <p class="text-slate-600 mb-8 text-lg leading-relaxed">Track progress, join contests, build portfolio</p>
                        <button class="btn-primary text-white px-8 py-4 rounded-xl font-bold text-lg">
                            ðŸš€ Start Learning Journey
                        </button>
                    </div>
                </div>
                
                <!-- Community User Card -->
                <div class="role-card auth-card rounded-3xl p-8 cursor-pointer" onclick="showForm('community')">
                    <div class="text-center">
                        <div class="w-20 h-20 bg-gradient-to-br from-purple-500 to-pink-600 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-lg">
                            <i data-lucide="users" class="w-10 h-10 text-white"></i>
                        </div>
                        <h3 class="text-2xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent mb-4">Community Builder</h3>
                        <p class="text-slate-600 mb-8 text-lg leading-relaxed">Manage teams, create learning communities</p>
                        <button class="btn-primary text-white px-8 py-4 rounded-xl font-bold text-lg">
                            ðŸŒŸ Build Community
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Personal Registration Form -->
        <div id="personalForm" class="form-container max-w-2xl mx-auto">
            <div class="auth-card rounded-3xl p-8">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-slate-800">Personal Learner Registration</h2>
                    <button onclick="showRoleSelection()" class="text-slate-600 hover:text-slate-800 p-2 rounded-lg hover:bg-slate-100">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
                
                <form id="personalRegistrationForm" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-slate-700">First Name *</label>
                            <input type="text" name="firstName" required class="form-input w-full px-4 py-3 rounded-xl">
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-slate-700">Last Name *</label>
                            <input type="text" name="lastName" required class="form-input w-full px-4 py-3 rounded-xl">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-slate-700">Username *</label>
                            <input type="text" name="username" required class="form-input w-full px-4 py-3 rounded-xl">
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-slate-700">Email *</label>
                            <input type="email" name="email" required class="form-input w-full px-4 py-3 rounded-xl">
                        </div>
                    </div>
                    
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-slate-700">Skill Level *</label>
                        <select name="skillLevel" required class="form-input w-full px-4 py-3 rounded-xl">
                            <option value="">Select skill level</option>
                            <option value="beginner">Beginner</option>
                            <option value="intermediate">Intermediate</option>
                            <option value="advanced">Advanced</option>
                        </select>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-slate-700">Education Level</label>
                            <select name="educationLevel" class="form-input w-full px-4 py-3 rounded-xl">
                                <option value="">Select education level</option>
                                <option value="high-school">High School</option>
                                <option value="bachelor">Bachelor's Degree</option>
                                <option value="master">Master's Degree</option>
                                <option value="phd">PhD</option>
                                <option value="self-taught">Self Taught</option>
                            </select>
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-slate-700">Field of Study</label>
                            <input type="text" name="fieldOfStudy" class="form-input w-full px-4 py-3 rounded-xl" placeholder="e.g., Computer Science">
                        </div>
                    </div>
                    
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-slate-700">Bio</label>
                        <textarea name="bio" rows="4" class="form-input w-full px-4 py-3 rounded-xl resize-none" placeholder="Tell us about yourself..."></textarea>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-slate-700">Password *</label>
                            <div class="relative">
                                <input type="password" name="password" id="personalPassword" required class="form-input w-full px-4 py-3 pr-12 rounded-xl">
                                <button type="button" class="password-toggle absolute right-3 top-1/2 transform -translate-y-1/2 p-2 rounded-lg" onclick="togglePassword('personalPassword')">
                                    <i data-lucide="eye" class="w-5 h-5 text-slate-400"></i>
                                </button>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-slate-700">Confirm Password *</label>
                            <div class="relative">
                                <input type="password" name="confirmPassword" id="personalConfirmPassword" required class="form-input w-full px-4 py-3 pr-12 rounded-xl">
                                <button type="button" class="password-toggle absolute right-3 top-1/2 transform -translate-y-1/2 p-2 rounded-lg" onclick="togglePassword('personalConfirmPassword')">
                                    <i data-lucide="eye" class="w-5 h-5 text-slate-400"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex items-start">
                        <input type="checkbox" name="agreeTerms" required class="w-5 h-5 text-red-600 border-slate-300 rounded focus:ring-red-500 mt-1">
                        <label class="ml-3 text-sm text-slate-600">
                            I agree to the <a href="../terms.html" target="_blank" class="text-red-600 hover:text-red-700 font-medium">Terms of Service</a> and <a href="../privacy.html" target="_blank" class="text-red-600 hover:text-red-700 font-medium">Privacy Policy</a>
                        </label>
                    </div>
                    
                    <button type="submit" class="btn-primary w-full py-3 px-6 rounded-xl text-white font-semibold text-lg flex items-center justify-center gap-2">
                        <i data-lucide="user-plus" class="w-5 h-5"></i>
                        Create Personal Account
                    </button>
                </form>
            </div>
        </div>

        <!-- Community Registration Form -->
        <div id="communityForm" class="form-container max-w-2xl mx-auto">
            <div class="auth-card rounded-3xl p-8">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-slate-800">Community Builder Registration</h2>
                    <button onclick="showRoleSelection()" class="text-slate-600 hover:text-slate-800 p-2 rounded-lg hover:bg-slate-100">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
                
                <form id="communityRegistrationForm" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-slate-700">First Name *</label>
                            <input type="text" name="firstName" required class="form-input w-full px-4 py-3 rounded-xl">
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-slate-700">Last Name *</label>
                            <input type="text" name="lastName" required class="form-input w-full px-4 py-3 rounded-xl">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-slate-700">Username *</label>
                            <input type="text" name="username" required class="form-input w-full px-4 py-3 rounded-xl">
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-slate-700">Email *</label>
                            <input type="email" name="email" required class="form-input w-full px-4 py-3 rounded-xl">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-slate-700">Community Name *</label>
                            <input type="text" name="communityName" required class="form-input w-full px-4 py-3 rounded-xl" placeholder="e.g., Stanford CS Department">
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-slate-700">Community Code *</label>
                            <input type="text" name="communityCode" required class="form-input w-full px-4 py-3 rounded-xl" placeholder="e.g., STANFORD" maxlength="10" oninput="this.value = this.value.toUpperCase().replace(/[^A-Z0-9]/g, '')" title="2-10 uppercase letters/numbers only">
                            <p class="text-xs text-slate-500 mt-1">2-10 uppercase letters/numbers only (auto-converted to uppercase)</p>
                        </div>
                    </div>
                    
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-slate-700">Community Description</label>
                        <textarea name="communityDescription" rows="3" class="form-input w-full px-4 py-3 rounded-xl" placeholder="Brief description of your community (optional)"></textarea>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-slate-700">Organization Size</label>
                            <select name="organizationSize" class="form-input w-full px-4 py-3 rounded-xl">
                                <option value="">Select size</option>
                                <option value="small">Small (1-50 people)</option>
                                <option value="medium">Medium (51-200 people)</option>
                                <option value="large">Large (200+ people)</option>
                            </select>
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-slate-700">Your Position</label>
                            <input type="text" name="position" class="form-input w-full px-4 py-3 rounded-xl" placeholder="e.g., Professor, Manager">
                        </div>
                    </div>
                    

                    
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-slate-700">Organization Website</label>
                        <input type="url" name="organizationWebsite" class="form-input w-full px-4 py-3 rounded-xl" placeholder="https://example.com">
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-slate-700">Password *</label>
                            <div class="relative">
                                <input type="password" name="password" id="communityPassword" required class="form-input w-full px-4 py-3 pr-12 rounded-xl">
                                <button type="button" class="password-toggle absolute right-3 top-1/2 transform -translate-y-1/2 p-2 rounded-lg" onclick="togglePassword('communityPassword')">
                                    <i data-lucide="eye" class="w-5 h-5 text-slate-400"></i>
                                </button>
                            </div>
                        </div>
                        <div class="space-y-2">
                            <label class="block text-sm font-medium text-slate-700">Confirm Password *</label>
                            <div class="relative">
                                <input type="password" name="confirmPassword" id="communityConfirmPassword" required class="form-input w-full px-4 py-3 pr-12 rounded-xl">
                                <button type="button" class="password-toggle absolute right-3 top-1/2 transform -translate-y-1/2 p-2 rounded-lg" onclick="togglePassword('communityConfirmPassword')">
                                    <i data-lucide="eye" class="w-5 h-5 text-slate-400"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex items-start">
                        <input type="checkbox" name="agreeTerms" required class="w-5 h-5 text-red-600 border-slate-300 rounded focus:ring-red-500 mt-1">
                        <label class="ml-3 text-sm text-slate-600">
                            I agree to the <a href="../terms.html" target="_blank" class="text-red-600 hover:text-red-700 font-medium">Terms of Service</a> and <a href="../privacy.html" target="_blank" class="text-red-600 hover:text-red-700 font-medium">Privacy Policy</a>
                        </label>
                    </div>
                    
                    <button type="submit" class="btn-primary w-full py-3 px-6 rounded-xl text-white font-semibold text-lg flex items-center justify-center gap-2">
                        <i data-lucide="users" class="w-5 h-5"></i>
                        Create Community Account
                    </button>
                </form>
            </div>
        </div>

        <!-- OTP Form -->
        <div id="otpForm" class="form-container max-w-md mx-auto">
            <div class="auth-card rounded-3xl p-8 text-center">
                <div class="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i data-lucide="mail" class="w-8 h-8 text-white"></i>
                </div>
                <h2 class="text-2xl font-bold text-slate-800 mb-4">Email Verification</h2>
                <p class="text-slate-600 mb-6">We've sent a 6-digit code to <span id="otpEmail" class="font-semibold"></span></p>
                <p class="text-slate-500 text-sm mb-6">Check your email inbox and spam folder for the verification code.</p>
                
                <form id="otpVerificationForm" class="space-y-6">
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-slate-700">Enter OTP</label>
                        <input type="text" id="otpInput" maxlength="6" placeholder="000000" required class="form-input w-full px-4 py-3 text-center text-xl font-bold rounded-xl">
                    </div>
                    
                    <button type="submit" class="btn-primary w-full py-3 px-6 rounded-xl text-white font-semibold text-lg flex items-center justify-center gap-2">
                        <i data-lucide="check" class="w-5 h-5"></i>
                        Verify Email
                    </button>
                    
                    <div class="flex items-center justify-center space-x-4">
                        <button type="button" id="resendOTPBtn" class="text-red-600 hover:text-red-700 font-medium hover:underline">
                            Resend OTP
                        </button>
                        <button type="button" onclick="showRoleSelection()" class="text-slate-600 hover:text-slate-700 font-medium hover:underline">
                            Back to Registration
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Back to Login -->
        <div class="text-center mt-12">
            <p class="text-slate-600">
                Already have an account? 
                <a href="login.html" class="text-red-600 hover:text-red-700 font-semibold hover:underline">Sign in here</a>
            </p>
        </div>
    </div>

    <!-- Simple JavaScript -->
    <script>
        lucide.createIcons();
        
        // Simple form switching
        function showForm(role) {
            console.log('Showing form for:', role);
            
            // Hide role selection
            document.getElementById('roleSelection').style.display = 'none';
            
            // Show appropriate form
            if (role === 'personal') {
                document.getElementById('personalForm').classList.add('show');
            } else if (role === 'community') {
                document.getElementById('communityForm').classList.add('show');
            }
        }
        
        function showRoleSelection() {
            console.log('Going back to role selection');
            
            // Hide all forms
            document.querySelectorAll('.form-container').forEach(form => {
                form.classList.remove('show');
            });
            
            // Show role selection
            document.getElementById('roleSelection').style.display = 'block';
        }
        
        // Form submission handlers
        document.getElementById('personalRegistrationForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            console.log('Personal form submitted');
            
            // Set the selected role for OTP redirect
            selectedRole = 'personal';
            
            const formData = new FormData(e.target);
            const userData = {
                role: 'personal',
                firstName: formData.get('firstName'),
                lastName: formData.get('lastName'),
                email: formData.get('email'),
                password: formData.get('password'),
                skillLevel: formData.get('skillLevel'),
                educationLevel: formData.get('educationLevel'),
                fieldOfStudy: formData.get('fieldOfStudy'),
                bio: formData.get('bio'),
                agreeTerms: formData.get('agreeTerms')
            };
            
            // Debug: Log all form data
            console.log('ðŸ” Form data being sent:', userData);
            console.log('ðŸ” skillLevel:', userData.skillLevel);
            console.log('ðŸ” educationLevel:', userData.educationLevel);
            console.log('ðŸ” selectedRole:', selectedRole);
            
            // Password will be set after OTP verification
            
            try {
                const response = await fetch('http://localhost:5001/api/v1/auth/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(userData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('ðŸŽ‰ Registration successful! Please check your email for OTP verification.');
                    // Show OTP form or redirect
                    showOTPForm(userData.email);
                } else {
                    console.log('âŒ Registration failed:', result);
                    alert('Registration failed: ' + result.message);
                }
            } catch (error) {
                console.error('âŒ Registration error:', error);
                alert('Registration failed: ' + error.message);
            }
        });
        
        document.getElementById('communityRegistrationForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            console.log('Community form submitted');
            
            // Set the selected role for OTP redirect
            selectedRole = 'community';
            
            const formData = new FormData(e.target);
            const userData = {
                role: 'community',
                firstName: formData.get('firstName'),
                lastName: formData.get('lastName'),
                email: formData.get('email'),
                password: formData.get('password'),
                communityName: formData.get('communityName'),
                communityCode: formData.get('communityCode'),
                communityDescription: formData.get('communityDescription'),
                organizationSize: formData.get('organizationSize'),
                position: formData.get('position'),
                organizationWebsite: formData.get('organizationWebsite'),
                agreeTerms: formData.get('agreeTerms')
            };
            
            // Debug: Log all form data
            console.log('ðŸ” Community form data being sent:', userData);
            console.log('ðŸ” selectedRole:', selectedRole);
            
            // Password will be set after OTP verification
            
            try {
                const response = await fetch('http://localhost:5001/api/v1/auth/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(userData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('ðŸŽ‰ Registration successful! Please check your email for OTP verification.');
                    // Show OTP form or redirect
                    showOTPForm(userData.email);
                } else {
                    console.log('âŒ Community registration failed:', result);
                    alert('Registration failed: ' + result.message);
                }
            } catch (error) {
                console.error('âŒ Community registration error:', error);
                alert('Registration failed: ' + error.message);
            }
        });
        
        // Show OTP form
        function showOTPForm(email) {
            console.log('ðŸŽ¯ showOTPForm called with email:', email);
            console.log('ðŸŽ¯ selectedRole:', selectedRole);
            console.log('ðŸŽ¯ currentEmail:', currentEmail);
            
            currentEmail = email;
            document.getElementById('otpEmail').textContent = email;
            
            // Hide all forms
            document.querySelectorAll('.form-container').forEach(form => {
                form.classList.remove('show');
                console.log('ðŸ”’ Hiding form:', form.id);
            });
            
            // Show OTP form
            const otpForm = document.getElementById('otpForm');
            console.log('ðŸŽ¯ OTP form element:', otpForm);
            console.log('ðŸŽ¯ OTP form classes before:', otpForm.className);
            
            otpForm.classList.add('show');
            console.log('ðŸŽ¯ OTP form classes after:', otpForm.className);
            console.log('ðŸŽ¯ OTP form display style:', window.getComputedStyle(otpForm).display);
        }
        
        // OTP verification handler
        document.getElementById('otpVerificationForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            console.log('OTP verification submitted');
            
            const otp = document.getElementById('otpInput').value;
            
            try {
                const response = await fetch('http://localhost:5001/api/v1/auth/verify-otp', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: currentEmail,
                        otp: otp,
                        password: selectedRole === 'personal' ? 
                            document.getElementById('personalPassword').value : 
                            document.getElementById('communityPassword').value
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('ðŸŽ‰ Email verified successfully! Redirecting...');
                    
                    // Redirect to login page after successful registration
                    setTimeout(() => {
                        const loginUrl = 'login.html';
                        console.log('ðŸ”„ Registration successful! Redirecting to login page:', loginUrl);
                        window.location.href = loginUrl;
                    }, 2000);
                } else {
                    alert('OTP verification failed: ' + result.message);
                }
            } catch (error) {
                alert('OTP verification failed: ' + error.message);
            }
        });
        
        // Resend OTP handler
        document.getElementById('resendOTPBtn').addEventListener('click', async function() {
            try {
                const response = await fetch('http://localhost:5001/api/v1/auth/resend-otp', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email: currentEmail,
                        type: 'verification'
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('OTP resent successfully!');
                } else {
                    alert('Failed to resend OTP: ' + result.message);
                }
            } catch (error) {
                alert('Failed to resend OTP: ' + error.message);
            }
        });
        
        // Track selected role
        let selectedRole = '';
        let currentEmail = '';
        
        // Update showForm to track role
        function showForm(role) {
            console.log('Showing form for:', role);
            selectedRole = role;
            
            // Hide role selection
            document.getElementById('roleSelection').style.display = 'none';
            
            // Show appropriate form
            if (role === 'personal') {
                document.getElementById('personalForm').classList.add('show');
            } else if (role === 'community') {
                document.getElementById('communityForm').classList.add('show');
            }
        }
        
        console.log('Registration page loaded successfully with full backend integration!');
        
        // Password toggle functionality
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const toggleBtn = input.parentNode.querySelector('.password-toggle');
            const eyeIcon = toggleBtn.querySelector('i');

            if (input.type === 'password') {
                input.type = 'text';
                eyeIcon.setAttribute('data-lucide', 'eye-off');
            } else {
                input.type = 'password';
                eyeIcon.setAttribute('data-lucide', 'eye');
            }
            lucide.createIcons();
        }
    </script>
</body>
</html>
